/**
 @license
 Sideshow - An incredible Javascript interactive help Library
 Version: 0.3.3
 Date: 2014-01-10 
 Author: Alcides Queiroz [alcidesqueiroz(at)gmail(dot)com]
 Available under Apache License 2.0 (https://raw2.github.com/fortesinformatica/sideshow/master/LICENSE)
 **/
(function(global,$,jazz,markdown){if($===undefined)throw new SSException("2","jQuery is required for Sideshow to work.");if(jazz===undefined)throw new SSException("3","Jazz is required for Sideshow to work.");if(markdown===undefined)throw new SSException("4","Pagedown (the Markdown parser used by Sideshow) is required for Sideshow to work.");var globalObjectName="Sideshow",$window,$body,$document,pollingDuration=150,longAnimationDuration=600,SS={get VERSION(){return"0.3.3"}},controlVariables=[],flags={lockMaskUpdate:false,changingStep:false,skippingStep:false,running:false},wizards=[],currentWizard,AnimationStatus=jazz.Enum("VISIBLE","FADING_IN","FADING_OUT","NOT_DISPLAYED","NOT_RENDERED","TRANSPARENT");function SSException(code,message){this.name="SSException";this.message="[SIDESHOW_E#"+("00000000"+code).substr(-8)+"] "+message}SSException.prototype=new Error;SSException.prototype.constructor=SSException;function showWarning(code,message){console.warn("[SIDESHOW_W#"+("00000000"+code).substr(-8)+"] "+message)}function parsePxValue(value){if(value.constructor!==String)return value;var br=value===""?"0":value;return+br.replace("px","")}function getString(stringKeyValuePair){if(!(SS.config.language in stringKeyValuePair)){showWarning("2001","String not found for the selected language, getting the first available.");return stringKeyValuePair[Object.keys(stringKeyValuePair)[0]]}return stringKeyValuePair[SS.config.language]}function registerInnerHotkeys(){$document.keyup(innerHotkeysListener)}function unregisterInnerHotkeys(){$document.unbind("keyup",innerHotkeysListener)}function innerHotkeysListener(e){if(e.keyCode==27||e.keyCode==112)SS.close()}function registerGlobalHotkeys(){$document.keyup(function(e){if(e.keyCode==113){if(e.shiftKey)SS.start({listAll:true});else SS.start()}})}function removeDOMGarbage(){$('[class*="sideshow"]').not(".sideshow-mask-part, .sideshow-mask-corner-part, .sideshow-subject-mask").remove()}var strings={availableWizards:{en:"Available Tutorials","pt-br":"Tutoriais Disponíveis"},relatedWizards:{en:"Related Wizards","pt-br":"Tutoriais Relacionados"},noAvailableWizards:{en:"There's no tutorials available.","pt-br":"Não há tutoriais disponíveis para esta tela."},close:{en:"Close","pt-br":"Fechar"},estimatedTime:{en:"Estimated Time","pt-br":"Tempo Estimado"},next:{en:"Next","pt-br":"Continuar"},finishWizard:{en:"Finish Wizard","pt-br":"Concluir Tutorial"}};SS.config={};SS.config.userPreferencesRoute=null;SS.config.loggedInUser=null;SS.config.language="en";SS.ControlVariables={};SS.ControlVariables.set=function(name,value){var variable={};if(this.isDefined(name)){variable=this.getNameValuePair(name)}else controlVariables.push(variable);variable.name=name;variable.value=value;return name+"="+value};SS.ControlVariables.setIfUndefined=function(name,value){if(!this.isDefined(name))return this.set(name,value)};SS.ControlVariables.isDefined=function(name){return this.getNameValuePair(name)!==undefined};SS.ControlVariables.get=function(name){var pair=this.getNameValuePair(name);return pair?pair.value:undefined};SS.ControlVariables.getNameValuePair=function(name){for(var i=0;i<controlVariables.length;i++){var variable=controlVariables[i];if(variable.name===name)return variable}};SS.ControlVariables.remove=function(name){return controlVariables.splice(controlVariables.indexOf(this.getNameValuePair(name)),1)};SS.ControlVariables.clear=function(){controlVariables=[]};var VisualItem=jazz.Class().abstract;VisualItem.field("$el");VisualItem.field("status",AnimationStatus.NOT_RENDERED);VisualItem.method("render",function($parent){($parent||$body).append(this.$el);this.status=AnimationStatus.NOT_DISPLAYED});VisualItem.method("destroy",function(){this.$el.remove()});var HidableItem=jazz.Class().extending(VisualItem).abstract;HidableItem.method("show",function(displayButKeepTransparent){if(!this.$el)this.render();if(!displayButKeepTransparent)this.$el.removeClass("sideshow-invisible");this.$el.removeClass("sideshow-hidden");this.status=AnimationStatus.VISIBLE});HidableItem.method("hide",function(keepHoldingSpace){if(!keepHoldingSpace)this.$el.addClass("sideshow-hidden");this.$el.addClass("sideshow-invisible");this.status=AnimationStatus.NOT_DISPLAYED});var FadableItem=jazz.Class().extending(HidableItem).abstract;FadableItem.method("fadeIn",function(callback,linearTimingFunction){var item=this;item.status=AnimationStatus.FADING_IN;if(!item.$el)this.render();if(linearTimingFunction)item.$el.css("animation-timing-function","linear");item.$el.removeClass("sideshow-hidden");setTimeout(function(){item.$el.removeClass("sideshow-invisible");setTimeout(function(){item.status=AnimationStatus.VISIBLE;if(linearTimingFunction)item.$el.css("animation-timing-function","ease");if(callback)callback()},longAnimationDuration)},20)});FadableItem.method("fadeOut",function(callback,linearTimingFunction){var item=this;if(item.status!=AnimationStatus.NOT_RENDERED){item.status=AnimationStatus.FADING_OUT;if(linearTimingFunction)item.$el.css("animation-timing-function","linear");item.$el.addClass("sideshow-invisible");setTimeout(function(){item.$el.addClass("sideshow-hidden");item.status=AnimationStatus.NOT_DISPLAYED;if(linearTimingFunction)item.$el.css("animation-timing-function","ease");if(callback)callback()},longAnimationDuration)}});var Wizard=jazz.Class(function(wizardConfig){this.name=wizardConfig.name;this.title=wizardConfig.title;this.description=wizardConfig.description;this.estimatedTime=wizardConfig.estimatedTime;this.affects=wizardConfig.affects;this.preparation=wizardConfig.preparation;this.listeners=wizardConfig.listeners;this.showStepPosition=wizardConfig.showStepPosition;this.relatedWizards=wizardConfig.relatedWizards});Wizard.field("preparation");Wizard.field("listeners");Wizard.field("showStepPosition");Wizard.field("relatedWizards");Wizard.field("name");Wizard.field("title");Wizard.field("description");Wizard.field("estimatedTime");Wizard.field("affects");Wizard.field("_storyline");Wizard.field("currentStep");Wizard.method("storyLine",function(storyline){this._storyline=storyline});Wizard.method("play",function(){var wiz=this;Polling.enqueue("check_composite_mask_subject_changes",function(){Mask.CompositeMask.singleInstance.pollForSubjectChanges()});Polling.enqueue("check_arrow_changes",function(){Arrows.pollForArrowsChanges()});if(!this._storyline)throw new SSException("201","A wizard needs to have a storyline.");var steps=this._storyline.steps;if(steps.length===0)throw new SSException("202","A storyline must have at least one step.");DetailsPanel.singleInstance.render();StepDescription.singleInstance.render();var listeners=this.listeners;if(listeners&&listeners.beforeWizardStarts)listeners.beforeWizardStarts();flags.changingStep=true;this.showStep(steps[0],function(){Polling.enqueue("check_completed_step",function(){wiz.pollForCheckCompletedStep()})});Mask.CompositeMask.singleInstance.fadeIn()});Wizard.method("showStep",function(step,callback){flags.skippingStep=false;Arrows.clear();if(this.currentStep&&this.currentStep.listeners&&this.currentStep.listeners.afterStep)this.currentStep.listeners.afterStep();function skipStep(wiz){flags.skippingStep=true;this.next()}if(step&&step.listeners&&step.listeners.beforeStep)step.listeners.beforeStep();this.currentStep=step;if(step.skipIf&&step.skipIf())skipStep(this);if(flags.changingStep&&!flags.skippingStep){if(step.subject)SS.setSubject(step.subject);else SS.setEmptySubject();Mask.CompositeMask.singleInstance.update(Subject.position,Subject.dimension,Subject.borderRadius);var sm=Mask.SubjectMask.singleInstance;sm.fadeOut(function(){if(step.lockSubject)sm.show(true)});DetailsPanel.singleInstance.show();DetailsPanel.singleInstance.positionate();var description=StepDescription.singleInstance;var text=step.text;text=text instanceof Function?SS.heredoc(text):text;if(step.format=="markdown"){description.setHTML((new markdown.Converter).makeHtml(text))}else description.setText(text);description.setTitle(step.title);description.setStepPosition(this.getStepPosition()+1+"/"+this._storyline.steps.length);if(step.showNextButton||step.autoContinue===false||!(step.completingConditions&&step.completingConditions.length>0)){var nextStep=this._storyline.steps[this.getStepPosition()+1];if(nextStep){description.nextButton.setText(getString(strings.next)+": "+this._storyline.steps[this.getStepPosition()+1].title)}else{description.nextButton.setText(getString(strings.finishWizard))}description.nextButton.show();if(step.autoContinue===false)description.nextButton.disable()}else{description.nextButton.hide()}if(step.targets&&step.targets.length>0){Arrows.setTargets(step.targets);Arrows.render();Arrows.positionate();Arrows.fadeIn()}description.show(true);if(!Mask.CompositeMask.singleInstance.scrollIfNecessary(Subject.position,Subject.dimension)){description.positionate();description.fadeIn()}if(callback)callback();flags.changingStep=false}});Wizard.method("next",function(callback,nextStep){if(!flags.changingStep||flags.skippingStep){flags.changingStep=true;var currentStep=this.currentStep;nextStep=nextStep||this._storyline.steps[this.getStepPosition(this.currentStep)+1];var self=this;this.hideStep(function(){if(nextStep)self.showStep(nextStep,function(){if(callback)callback()});else{if(currentStep&&currentStep.listeners&&currentStep.listeners.afterStep)currentStep.listeners.afterStep();var completedWizard=currentWizard;currentWizard=null;var listeners=self.listeners;if(listeners&&listeners.afterWizardEnds)listeners.afterWizardEnds();if(!SS.showRelatedWizardsList(completedWizard))SS.close()}})}});Wizard.method("hideStep",function(callback){StepDescription.singleInstance.fadeOut(function(){DetailsPanel.singleInstance.hide()});Arrows.fadeOut();Mask.SubjectMask.singleInstance.update(Subject.position,Subject.dimension,Subject.borderRadius);Mask.SubjectMask.singleInstance.fadeIn(callback)});Wizard.method("getStepPosition",function(step){return this._storyline.steps.indexOf(step||this.currentStep)});Wizard.method("isEligible",function(){var l=global.location;function isEqual(a,b,caseSensitive){return caseSensitive?a===b:a.toLowerCase()===b.toLowerCase()}for(var c=0;c<this.affects.length;c++){var condition=this.affects[c];if(condition instanceof Function){if(condition())return true}else if(condition instanceof Object){if("route"in condition){var route=l.pathname+l.search+l.hash;if(isEqual(route,condition.route,condition.caseSensitive))return true}if("hash"in condition){if(isEqual(location.hash,condition.hash,condition.caseSensitive))return true}if("url"in condition){if(isEqual(location.href,condition.url,condition.caseSensitive))return true}}}return false});Wizard.method("isAlreadyWatched",function(){return false});Wizard.method("pollForCheckCompletedStep",function(){var conditions=this.currentStep.completingConditions;if(conditions&&conditions.length>0&&!flags.skippingStep){var completed=true;for(var fn=0;fn<conditions.length;fn++){var completingCondition=conditions[fn];if(!completingCondition())completed=false}if(completed){if(this.currentStep.autoContinue===false)StepDescription.singleInstance.nextButton.enable();else currentWizard.next()}}});var DetailsPanel=jazz.Class().extending(FadableItem).singleton;DetailsPanel.field("dimension",{});DetailsPanel.field("position",{});DetailsPanel.method("render",function(){this.$el=$("<div>").addClass("sideshow-details-panel").addClass("sideshow-hidden");this.callSuper("render")});DetailsPanel.method("positionate",function(){var parts=Mask.CompositeMask.singleInstance.parts;var sortedSides=[[parts.top,"height"],[parts.right,"width"],[parts.bottom,"height"],[parts.left,"width"]].sort(function(a,b){return a[0].dimension[a[1]]-b[0].dimension[b[1]]});var biggestSide=sortedSides.slice(-1)[0];for(var i=2;i>0;i--){var side=sortedSides[i];var dimension=side[0].dimension;if(dimension.width>250&&dimension.height>250){if(dimension.width+dimension.height>(biggestSide[0].dimension.width+biggestSide[0].dimension.height)*2)biggestSide=side}}if(biggestSide[1]=="width"){this.$el.css("left",biggestSide[0].position.x).css("top",0).css("height",Screen.dimension.height).css("width",biggestSide[0].dimension.width)}else{this.$el.css("left",0).css("top",biggestSide[0].position.y).css("height",biggestSide[0].dimension.height).css("width",Screen.dimension.width)}this.dimension={width:parsePxValue(this.$el.css("width")),height:parsePxValue(this.$el.css("height"))};this.position={x:parsePxValue(this.$el.css("left")),y:parsePxValue(this.$el.css("top"))}});var Arrows={};Arrows.arrows=[];Arrows.clear=function(){this.arrows=[]};Arrows.setTargets=function(targets){if(targets.constructor===String)targets=$(targets);if(targets instanceof $&&targets.length>0){targets.each(function(){var arrow=Arrow.build();arrow.target.$el=$(this);if(arrow.target.$el.is(":visible")){Arrows.arrows.push(arrow);arrow.onceVisible=true}})}else{throw new SSException("150","Invalid targets.")}};Arrows.recreateDOMReferences=function(){for(var a=0;a<this.arrows.length;a++){var arrow=this.arrows[a];arrow.$el.remove()}Arrows.clear();Arrows.setTargets(currentWizard.currentStep.targets);Arrows.render();Arrows.positionate();Arrows.show()};Arrows.show=function(){for(var a=0;a<this.arrows.length;a++){var arrow=this.arrows[a];arrow.show()}};Arrows.hide=function(){for(var a=0;a<this.arrows.length;a++){var arrow=this.arrows[a];arrow.hide()}};Arrows.fadeIn=function(){for(var a=0;a<this.arrows.length;a++){var arrow=this.arrows[a];arrow.fadeIn()}};Arrows.fadeOut=function(){for(var a=0;a<this.arrows.length;a++){var arrow=this.arrows[a];registerFadeOut(arrow)}function registerFadeOut(arrow){arrow.fadeOut(function(){arrow.destroy()})}};Arrows.positionate=function(){for(var a=0;a<this.arrows.length;a++){var arrow=this.arrows[a];arrow.positionate()}};Arrows.render=function(){for(var a=0;a<this.arrows.length;a++){var arrow=this.arrows[a];arrow.render()}};Arrows.pollForArrowsChanges=function(){var brokenReference=false;for(var a=0;a<this.arrows.length;a++){var arrow=this.arrows[a];if(arrow.hasChanged())arrow.positionate();if(arrow.onceVisible&&!arrow.target.$el.is(":visible"))brokenReference=true}if(brokenReference)this.recreateDOMReferences()};var Arrow=jazz.Class().extending(FadableItem);Arrow.field("target",{});Arrow.field("onceVisible",false);Arrow.method("render",function(){this.$el=$("<div>").addClass("sideshow-subject-arrow").addClass("sideshow-hidden").addClass("sideshow-invisible");this.callSuper("render")});Arrow.method("positionate",function(){var target=this.target;target.position={x:target.$el.offset().left-$window.scrollLeft(),y:target.$el.offset().top-$window.scrollTop()};target.dimension={width:target.$el.outerWidth(),height:target.$el.outerHeight()};this.$el.css("top",target.position.y-30+"px").css("left",target.position.x+parsePxValue(target.dimension.width)/2-12+"px")});Arrow.method("show",function(){this.callSuper("show");this.positionate()});Arrow.method("fadeIn",function(){this.callSuper("fadeIn");this.positionate()});Arrow.method("hasChanged",function(){return this.target.dimension.width!==this.target.$el.outerWidth()||this.target.dimension.height!==this.target.$el.outerHeight()||this.target.position.y!==this.target.$el.offset().top-$window.scrollTop()||this.target.position.x!==this.target.$el.offset().left-$window.scrollLeft()});var StepDescription=jazz.Class(function(){this.nextButton=StepDescriptionNextButton.build()}).extending(FadableItem).singleton;StepDescription.field("text","");StepDescription.field("title","");StepDescription.field("dimension",{});StepDescription.field("position",{});StepDescription.field("nextButton");StepDescription.method("setText",function(text){this.text=text;this.$el.find(".sideshow-step-text").text(text)});StepDescription.method("setHTML",function(text){this.text=text;this.$el.find(".sideshow-step-text").html(text)});StepDescription.method("setTitle",function(title){this.title=title;this.$el.find("h2:first").text(title)});StepDescription.method("setStepPosition",function(stepPosition){this.stepPosition=stepPosition;this.$el.find(".sideshow-step-position").text(stepPosition)});StepDescription.method("render",function(){this.$el=$("<div>").addClass("sideshow-step-description").addClass("sideshow-hidden").addClass("sideshow-invisible");var stepPosition=$("<span>").addClass("sideshow-step-position");this.$el.append(stepPosition);if(currentWizard.showStepPosition===false)stepPosition.hide();this.$el.append($("<h2>"));this.$el.append($("<div>").addClass("sideshow-step-text"));this.nextButton.render(this.$el);this.nextButton.$el.click(function(){currentWizard.next()});DetailsPanel.singleInstance.$el.append(this.$el)});StepDescription.method("show",function(displayButKeepTransparent){this.callSuper("show",displayButKeepTransparent)});StepDescription.method("positionate",function(){var dp=DetailsPanel.singleInstance;if(dp.dimension.width>=900)this.dimension.width=900;else this.dimension.width=dp.dimension.width*.9;this.$el.css("width",this.dimension.width);var paddingLeftRight=(parsePxValue(this.$el.css("padding-left"))+parsePxValue(this.$el.css("padding-right")))/2;var paddingTopBottom=(parsePxValue(this.$el.css("padding-top"))+parsePxValue(this.$el.css("padding-bottom")))/2;this.dimension.height=parsePxValue(this.$el.outerHeight());if(this.dimension.height>dp.dimension.height||this.dimension.width<400){this.dimension.width=$window.width()*.9;this.$el.css("width",this.dimension.width);this.dimension.height=parsePxValue(this.$el.outerHeight());this.position.x=($window.width()-this.dimension.width)/2;this.position.y=($window.height()-this.dimension.height)/2}else{this.position.x=(dp.dimension.width-this.dimension.width)/2;this.position.y=(dp.dimension.height-this.dimension.height)/2}this.$el.css("left",this.position.x-paddingLeftRight);this.$el.css("top",this.position.y-paddingTopBottom)});var StepDescriptionNextButton=jazz.Class().extending(HidableItem);StepDescriptionNextButton.field("_text");StepDescriptionNextButton.method("disable",function(){this.$el.attr("disabled","disabled")});StepDescriptionNextButton.method("enable",function(){this.$el.attr("disabled",null)});StepDescriptionNextButton.method("setText",function(text){this._text=text;this.$el.text(text)});StepDescriptionNextButton.method("render",function($stepDescriptionEl){this.$el=$("<button>").addClass("sideshow-next-step-button");this.callSuper("render",$stepDescriptionEl)});var Screen={};Screen.dimension={};Screen.hasChanged=function(){return $window.width()!==this.dimension.width||$window.height()!==this.dimension.height};Screen.updateInfo=function(){this.dimension.width=$window.width();this.dimension.height=$window.height()};var Subject={};Subject.obj=null;Subject.dimension={};Subject.position={};Subject.borderRadius={};Subject.hasChanged=function(){if(!this.obj)return false;return this.obj.offset().left-$window.scrollLeft()!==this.position.x||this.obj.offset().top-$window.scrollTop()!==this.position.y||this.obj.outerWidth()!==this.dimension.width||this.obj.outerHeight()!==this.dimension.height||parsePxValue(this.obj.css("border-top-left-radius"))!==this.borderRadius.leftTop||parsePxValue(this.obj.css("border-top-right-radius"))!==this.borderRadius.rightTop||parsePxValue(this.obj.css("border-bottom-left-radius"))!==this.borderRadius.leftBottom||parsePxValue(this.obj.css("border-bottom-right-radius"))!==this.borderRadius.rightBottom||Screen.hasChanged()};Subject.updateInfo=function(config){if(config===undefined){this.position.x=this.obj.offset().left-$window.scrollLeft();this.position.y=this.obj.offset().top-$window.scrollTop();this.dimension.width=this.obj.outerWidth();this.dimension.height=this.obj.outerHeight();this.borderRadius.leftTop=parsePxValue(this.obj.css("border-top-left-radius"));this.borderRadius.rightTop=parsePxValue(this.obj.css("border-top-right-radius"));this.borderRadius.leftBottom=parsePxValue(this.obj.css("border-bottom-left-radius"));this.borderRadius.rightBottom=parsePxValue(this.obj.css("border-bottom-right-radius"))}else{this.position.x=config.position.x;this.position.y=config.position.y;this.dimension.width=config.dimension.width;this.dimension.height=config.dimension.height;this.borderRadius.leftTop=config.borderRadius.leftTop;this.borderRadius.rightTop=config.borderRadius.rightTop;this.borderRadius.leftBottom=config.borderRadius.leftBottom;this.borderRadius.rightBottom=config.borderRadius.rightBottom}Screen.updateInfo()};Subject.isSubjectVisible=function(position,dimension){if(position.y+dimension.height>$window.height()||position.y<0){return false}return true};var Mask={};Mask.SubjectMask=jazz.Class().extending(FadableItem).singleton;Mask.SubjectMask.method("render",function(){this.$el=$("<div>").addClass("sideshow-subject-mask");this.callSuper("render")});Mask.SubjectMask.method("update",function(position,dimension,borderRadius){this.$el.css("left",position.x).css("top",position.y).css("width",dimension.width).css("height",dimension.height).css("border-radius",borderRadius.leftTop+"px "+borderRadius.rightTop+"px "+borderRadius.leftBottom+"px "+borderRadius.rightBottom+"px ")});Mask.CompositeMask=jazz.Class().extending(FadableItem).singleton;Mask.CompositeMask.method("init",function(){var mask=this;["top","left","right","bottom"].forEach(function(d){mask.parts[d]=Mask.CompositeMask.Part.build()});["leftTop","rightTop","leftBottom","rightBottom"].forEach(function(d){mask.parts[d]=Mask.CompositeMask.CornerPart.build()})});Mask.CompositeMask.field("parts",{});Mask.CompositeMask.method("render",function(){var mask=this;for(var p in this.parts){var part=this.parts[p];if(part.render)part.render()}this.$el=$(".sideshow-mask-part, .sideshow-mask-corner-part");Mask.SubjectMask.singleInstance.render();["leftTop","rightTop","leftBottom","rightBottom"].forEach(function(d){mask.parts[d].$el.addClass(d)});this.status=AnimationStatus.NOT_DISPLAYED});Mask.CompositeMask.method("scrollIfNecessary",function(position,dimension){function doSmoothScroll(scrollTop,callback){$("body,html").animate({scrollTop:scrollTop},300,callback)}if(!Subject.isSubjectVisible(position,dimension)){var description=StepDescription.singleInstance;var y=dimension.height>$window.height()-50?position.y:position.y-25;y+=$window.scrollTop();doSmoothScroll(y,function(){setTimeout(function(){DetailsPanel.singleInstance.positionate();description.positionate();description.fadeIn()},300)});return true}return false});Mask.CompositeMask.method("update",function(position,dimension,borderRadius){Mask.SubjectMask.singleInstance.update(position,dimension,borderRadius);var left=position.x,top=position.y,width=dimension.width,height=dimension.height,br=borderRadius;this.parts.top.update({x:0,y:0},{width:$window.width(),height:top});this.parts.left.update({x:0,y:top},{width:left,height:height});this.parts.right.update({x:left+width,y:top},{width:$window.width()-(left+width),height:height});this.parts.bottom.update({x:0,y:top+height},{width:$window.width(),height:$window.height()-(top+height)});this.parts.leftTop.update({x:left,y:top},br.leftTop);this.parts.rightTop.update({x:left+width-br.rightTop,y:top},br.rightTop);this.parts.leftBottom.update({x:left,y:top+height-br.leftBottom},br.leftBottom);this.parts.rightBottom.update({x:left+width-br.rightBottom,y:top+height-br.rightBottom},br.rightBottom)});Mask.CompositeMask.method("pollForSubjectChanges",function(){if(!flags.lockMaskUpdate){if(currentWizard&&currentWizard.currentStep.subject){var subject=$(currentWizard.currentStep.subject);if(Subject.obj[0]!==subject[0])SS.setSubject(subject)}if(Subject.hasChanged()){Subject.updateInfo();this.update(Subject.position,Subject.dimension,Subject.borderRadius)}}});Mask.CompositeMask.method("pollForScreenChanges",function(){if(Screen.hasChanged()){Screen.updateInfo();this.update(Subject.position,Subject.dimension,Subject.borderRadius)}});Mask.CompositeMask.Part=jazz.Class(function(position,dimension){this.position=position;this.dimension=dimension}).extending(VisualItem);var Part=Mask.CompositeMask.Part;Part.field("position",{});Part.field("dimension",{});Part.method("render",function(){this.$el=$("<div>").addClass("sideshow-mask-part").addClass("sideshow-hidden").addClass("sideshow-invisible");this.callSuper("render")});Part.method("update",function(position,dimension){this.position=position;this.dimension=dimension;this.$el.css("left",position.x).css("top",position.y).css("width",dimension.width).css("height",dimension.height)});Mask.CompositeMask.CornerPart=jazz.Class().extending(VisualItem);var CornerPart=Mask.CompositeMask.CornerPart;CornerPart.field("position",{});CornerPart.field("dimension",{});CornerPart.field("borderRadius",0);CornerPart.static.SVGPathPointsTemplate=function(borderRadius){return"m 0,0 0,"+borderRadius+" C 0,"+borderRadius*.46+" "+borderRadius*.46+",0 "+borderRadius+",0"};CornerPart.static.buildSVG=function(borderRadius){function SVG(nodeName){return document.createElementNS("http://www.w3.org/2000/svg",nodeName)}var bezierPoints=this.SVGPathPointsTemplate(borderRadius);var $svg=$(SVG("svg"));var $path=$(SVG("path"));$path.attr("d",bezierPoints);$svg.append($path);return $svg[0]};CornerPart.prototype.render=function(){this.$el=$("<div>").addClass("sideshow-mask-corner-part").addClass("sideshow-hidden").addClass("sideshow-invisible");this.$el.append(CornerPart.buildSVG(this.borderRadius));$body.append(this.$el);return this.$el};CornerPart.prototype.update=function(position,borderRadius){this.$el.css("left",position.x).css("top",position.y).css("width",borderRadius).css("height",borderRadius);$(this.$el).find("path").attr("d",CornerPart.SVGPathPointsTemplate(borderRadius))};var Polling={};Polling.queue=[];Polling.lock=false;Polling.enqueue=function(){var firstArg=arguments[0];var fn;var name="";if(typeof firstArg=="function")fn=firstArg;else{name=arguments[0];fn=arguments[1]}if(this.getFunctionIndex(fn)<0&&(name===""||this.getFunctionIndex(name)<0)){this.queue.push({name:name,fn:fn,enabled:true})}else throw new SSException("301","The function is already in the polling queue.")};Polling.dequeue=function(){this.queue.splice(this.getFunctionIndex(arguments[0]),1)};Polling.enable=function(){this.queue[this.getFunctionIndex(arguments[0])].enabled=true};Polling.disable=function(){this.queue[this.getFunctionIndex(arguments[0])].enabled=false};Polling.getFunctionIndex=function(){var firstArg=arguments[0];if(typeof firstArg=="function")return this.queue.map(function(p){return p.fn}).indexOf(firstArg);else if(typeof firstArg=="string")return this.queue.map(function(p){return p.name}).indexOf(firstArg);throw new SSException("302","Invalid argument for getFunctionIndex method. Expected a string (the polling function name) or a function (the polling function itself).")};Polling.start=function(){this.lock=false;this.doPolling()};Polling.stop=function(){this.lock=true};Polling.clear=function(){var lock=this.lock;this.lock=true;this.queue=[];this.lock=lock};Polling.doPolling=function(){if(!this.lock){setTimeout(function(){for(var fn=0;fn<Polling.queue.length;fn++){var pollingFunction=Polling.queue[fn];pollingFunction.enabled&&pollingFunction.fn()}Polling.doPolling()},pollingDuration)}};var WizardMenu={};WizardMenu.render=function(wizards){var $menu=$("<div>").addClass("sideshow-wizard-menu");this.$el=$menu;var $title=$("<h1>").addClass("sideshow-wizard-menu-title");$menu.append($title);if(wizards.length>0){var $wizardsList=$("<ul>");function setClick($wiz,wizard){$wiz.click(function(){WizardMenu.hide(function(){currentWizard=wizard;if(!currentWizard.isEligible()){if(currentWizard.preparation)currentWizard.preparation(function(){wizard.play()});else throw new SSException("203","This wizard is not eligible neither has a preparation function.")}else wizard.play()})})}for(var w=0;w<wizards.length;w++){var wiz=wizards[w];var $wiz=$("<li>");var $wizTitle=$("<h2>").text(wiz.title);var description=wiz.description;description.length>100&&(description=description.substr(0,100)+"...");var $wizDescription=$("<span>").addClass("sideshow-wizard-menu-item-description").text(description);var $wizEstimatedTime=$("<span>").addClass("sideshow-wizard-menu-item-estimated-time").text(wiz.estimatedTime);$wiz.append($wizEstimatedTime,$wizTitle,$wizDescription);$wizardsList.append($wiz);setClick($wiz,wiz)}$menu.append($wizardsList)}else{$("<div>").addClass("sideshow-no-wizards-available").text(getString(strings.noAvailableWizards)).appendTo($menu)}$body.append($menu)};WizardMenu.show=function(wizards,title){SS.setEmptySubject();Mask.CompositeMask.singleInstance.update(Subject.position,Subject.dimension,Subject.borderRadius);Mask.CompositeMask.singleInstance.fadeIn();WizardMenu.render(wizards);if(title)this.setTitle(title);else this.setTitle(getString(strings.availableWizards))};WizardMenu.hide=function(callback){var menu=this;menu.$el.addClass("sideshow-menu-closed");setTimeout(function(){menu.$el.hide();if(callback)callback()},longAnimationDuration)};WizardMenu.setTitle=function(title){this.$el.find(".sideshow-wizard-menu-title").text(title)};SS.init=function(){$window=$(global);$document=$(global.document);$body=$("body",global.document);registerGlobalHotkeys();Polling.start();Mask.CompositeMask.singleInstance.init();flags.lockMaskUpdate=true;Mask.CompositeMask.singleInstance.render()};SS.heredoc=function(fn){return fn.toString().match(/[^]*\/\*([^]*)\*\/\}$/)[1]};SS.close=function(){if(!currentWizard)WizardMenu.hide();DetailsPanel.singleInstance.fadeOut();this.CloseButton.singleInstance.fadeOut();Arrows.fadeOut();setTimeout(function(){if(Mask.CompositeMask.singleInstance.status===AnimationStatus.VISIBLE||Mask.CompositeMask.singleInstance.status===AnimationStatus.FADING_IN)Mask.CompositeMask.singleInstance.fadeOut();Mask.SubjectMask.singleInstance.fadeOut()},longAnimationDuration);removeDOMGarbage();Polling.clear();SS.ControlVariables.clear();unregisterInnerHotkeys();currentWizard=null;flags.running=false};SS.runWizard=function(name){var wiz=wizards.filter(function(w){return w.name===name})[0];currentWizard=wiz;if(wiz){if(wiz.isEligible())wiz.play();else if(wiz.preparation)wiz.preparation(function(){setTimeout(function(){wiz.play()},1e3)});else throw new SSException("204","This wizard hasn't preparation.")}else throw new SSException("204","There's no wizard with name "+name+".")};SS.gotoStep=function(){var firstArg=arguments[0],steps=currentWizard._storyline.steps,destination;flags.skippingStep=true;if(typeof firstArg=="number"){if(firstArg<=steps.length)destination=steps[firstArg-1];else throw new SSException("401","There's no step in the storyline with position "+firstArg+".")}else if(typeof firstArg=="string"){destination=steps.filter(function(i){return i.name===firstArg})[0];if(!destination)throw new SSException("401","There's no step in the storyline with name "+firstArg+".")}setTimeout(function(){currentWizard.next(null,destination)},100)};SS.setEmptySubject=function(){flags.lockMaskUpdate=true;Subject.obj=null;Subject.updateInfo({dimension:{width:0,height:0},position:{x:0,y:0},borderRadius:{leftTop:0,rightTop:0,leftBottom:0,rightBottom:0}})};SS.setSubject=function(subj){if(subj.constructor===String)subj=$(subj);if(subj instanceof $&&subj.length>0){if(subj.length===1){Subject.obj=subj;Subject.updateInfo();flags.lockMaskUpdate=false}else throw new SSException("101","A subject must have only one element. Multiple elements by step will be supported in future versions of Sideshow.")}else{throw new SSException("100","Invalid subject.")}};SS.registerWizard=function(wizardConfig){var wiz=Wizard.build(wizardConfig);wizards.push(wiz);return wiz};SS.getElegibleWizards=function(onlyNew){var eligibleWizards=[];var somethingNew=false;for(var w=0;w<wizards.length;w++){var wiz=wizards[w];if(wiz.isEligible()){if(!wiz.isAlreadyWatched())somethingNew=true;eligibleWizards.push(wiz)}}return!onlyNew||somethingNew?eligibleWizards:[]};SS.showWizardsList=function(){var firstArg=arguments[0];var title=arguments[1];var onlyNew=typeof firstArg=="boolean"?false:firstArg;var wizards=firstArg instanceof Array?firstArg:this.getElegibleWizards(onlyNew);
WizardMenu.show(wizards,title);return wizards.length>0};SS.showRelatedWizardsList=function(completedWizard){var relatedWizardsNames=completedWizard.relatedWizards;if(!relatedWizardsNames)return false;var relatedWizards=wizards.filter(function(w){return relatedWizardsNames.indexOf(w.name)>-1&&(w.isEligible()||w.preparation)});if(relatedWizards.length==0)return false;Polling.clear();SS.ControlVariables.clear();SS.showWizardsList(relatedWizards,getString(strings.relatedWizards));return true};SS.CloseButton=jazz.Class().extending(FadableItem).singleton;SS.CloseButton.method("render",function(){this.$el=$("<button>").addClass("sideshow-close-button").text(getString(strings.close));this.$el.click(function(){SS.close()});this.callSuper("render")});SS.start=function(config){config=config||{};if(!flags.running){var onlyNew="onlyNew"in config&&!!config.onlyNew;var listAll="listAll"in config&&!!config.listAll;if(listAll)SS.showWizardsList(wizards.filter(function(w){return w.isEligible()||w.preparation}));else SS.showWizardsList(onlyNew);this.CloseButton.singleInstance.render();this.CloseButton.singleInstance.fadeIn();registerInnerHotkeys();flags.running=true;Polling.enqueue("check_composite_mask_screen_changes",function(){Mask.CompositeMask.singleInstance.pollForScreenChanges()})}};if(global[globalObjectName]===undefined){global[globalObjectName]=SS}else throw new SSException("1",'The global access point "Sideshow" is already being used.')})(window,jQuery,Jazz,Markdown);